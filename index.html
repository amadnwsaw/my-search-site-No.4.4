<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NovaSeek</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto&display=swap" rel="stylesheet" />
  <style>
    /* Reset and base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 24px 16px;
      font-family: 'Roboto', sans-serif;
      background: #0a0a1a;
      color: #eee;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-size: cover;
      background-position: center;
      transition: background 0.6s ease;
    }
    header {
      width: 100%; max-width: 960px;
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 24px;
      position: relative;
    }
    .logo {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 2.8rem;
      background: linear-gradient(90deg, #a178ff, #70c3ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      user-select: none;
      letter-spacing: 0.08em;
    }

    /* Auth Button */
    #authButton {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #7050ff, #512ecc);
      border: none;
      cursor: pointer;
      display: flex; justify-content: center; align-items: center;
      box-shadow: 0 0 8px #7050ffaa;
      transition: background 0.3s;
      user-select: none;
    }
    #authButton:hover {
      background: linear-gradient(135deg, #512ecc, #7050ff);
      box-shadow: 0 0 12px #7050ffdd;
    }
    #authButton img {
      width: 44px; height: 44px;
      border-radius: 50%;
      object-fit: cover;
    }

    /* Auth Popup */
    #authPopup {
      position: absolute;
      top: 60px; right: 0;
      background: rgba(18, 18, 38, 0.95);
      border-radius: 14px;
      padding: 24px 28px;
      width: 320px;
      box-shadow: 0 8px 24px rgba(50,50,90,0.8);
      display: none;
      flex-direction: column;
      gap: 16px;
      z-index: 1100;
      color: #ddd;
      font-size: 0.95rem;
      user-select: none;
    }
    #authPopup.active {
      display: flex;
      animation: fadeInScale 0.3s ease forwards;
    }
    @keyframes fadeInScale {
      0% {opacity: 0; transform: scale(0.85);}
      100% {opacity: 1; transform: scale(1);}
    }
    #authPopup input, #authPopup button {
      font-size: 1rem;
      padding: 12px 14px;
      border-radius: 10px;
      border: none;
      outline: none;
      width: 100%;
      background: #1c1c40;
      color: #eee;
      box-shadow: inset 0 0 6px #7050ff66;
      transition: box-shadow 0.3s;
    }
    #authPopup input:focus {
      box-shadow: inset 0 0 8px #a178ffcc;
    }
    #authPopup button {
      background: linear-gradient(135deg, #7050ff, #512ecc);
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 0 10px #7050ffcc;
      transition: background 0.3s, box-shadow 0.3s;
      user-select: none;
    }
    #authPopup button:hover {
      background: linear-gradient(135deg, #512ecc, #7050ff);
      box-shadow: 0 0 14px #7050ffee;
    }
    #authPopup .switch-mode {
      background: transparent;
      color: #a0a0c7;
      font-weight: 600;
      font-size: 0.9rem;
      text-align: center;
      cursor: pointer;
      margin-top: 6px;
      user-select: none;
      letter-spacing: 0.02em;
      transition: color 0.3s;
    }
    #authPopup .switch-mode:hover {
      color: #d1d1ff;
      text-decoration: underline;
    }
    #authPopup small {
      color: #8888aa;
      font-size: 0.82rem;
      text-align: center;
      user-select: none;
    }

    /* Search Box */
    .search-box {
      width: 100%;
      max-width: 960px;
      display: flex;
      gap: 12px;
      margin-bottom: 32px;
    }
    .search-box input[type="text"] {
      flex: 1;
      padding: 14px 18px;
      border-radius: 14px;
      border: none;
      font-size: 1.15rem;
      outline: none;
      background: #1c1c40;
      color: #eee;
      box-shadow: inset 0 0 8px #7050ff99;
      transition: box-shadow 0.3s;
    }
    .search-box input[type="text"]:focus {
      box-shadow: inset 0 0 12px #a178ffcc;
    }
    /* æ”¹æˆåœ“å½¢æŒ‰éˆ• */
    .search-box button {
      background: linear-gradient(135deg, #7050ff, #512ecc);
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.3rem;
      box-shadow: 0 0 12px #7050ffcc;
      transition: background 0.3s, box-shadow 0.3s;
      display: flex; align-items: center; justify-content: center;
      user-select: none;
    }
    .search-box button:hover {
      background: linear-gradient(135deg, #512ecc, #7050ff);
      box-shadow: 0 0 16px #7050ffee;
    }
    .search-box button:active {
      transform: scale(0.95);
      transition: transform 0.1s;
    }

    /* Results Grid */
    #results {
      width: 100%;
      max-width: 960px;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
      gap: 20px;
    }
    .item {
      background: rgba(112, 80, 255, 0.12);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 14px #7050ff88;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: default;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    .item:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 24px #a178ffcc;
    }
    .item img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: #333;
      filter: drop-shadow(0 0 2px #7050ffaa);
      transition: filter 0.3s;
    }
    .item-content {
      padding: 12px 16px 16px 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      color: #ddd;
    }
    .item-content h3 {
      margin: 0;
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: 0.04em;
      user-select: text;
    }
    .item-content p {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.3;
      color: #bbb;
      user-select: text;
    }
    .item-content small {
      color: #aaa;
      font-size: 0.82rem;
      font-style: italic;
      margin-top: auto;
      user-select: text;
    }

    /* Background toggle button */
    .background-toggle {
      margin-top: 36px;
      background: linear-gradient(135deg, #7050ff, #512ecc);
      border: none;
      padding: 14px 26px;
      border-radius: 24px;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 14px #7050ffcc;
      transition: background 0.3s, box-shadow 0.3s;
      user-select: none;
      max-width: 960px;
      width: 100%;
      max-width: 240px;
    }
    .background-toggle:hover {
      background: linear-gradient(135deg, #512ecc, #7050ff);
      box-shadow: 0 0 20px #7050ffee;
    }
    .background-toggle:active {
      transform: scale(0.95);
      transition: transform 0.1s;
    }

    /* Responsive */
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      .search-box {
        flex-direction: column;
      }
      .search-box button {
        width: 48px;
        height: 48px;
      }
      #authPopup {
        right: auto;
        left: 50%;
        transform: translateX(-50%);
        width: 90vw;
        max-width: 320px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">NovaSeek</div>
    <button id="authButton" title="ç™»å…¥/è¨»å†Š">ç™»å…¥</button>
    <div id="authPopup" tabindex="-1" role="dialog" aria-modal="true" aria-labelledby="authTitle"></div>
  </header>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="è¼¸å…¥é—œéµå­—..." autocomplete="off" />
    <button id="searchBtn" title="æœå°‹">ğŸ”</button>
    <button id="voiceBtn" title="èªéŸ³æœå°‹">ğŸ¤</button>
  </div>

  <div id="results"></div>

  <button class="background-toggle" title="åˆ‡æ›èƒŒæ™¯">åˆ‡æ›èƒŒæ™¯</button>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail,
      signOut,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA7K4x1Di_xUaVt7MF08LfumJxc10dqa3c",
      authDomain: "sample-firebase-ai-app-df21b.firebaseapp.com",
      projectId: "sample-firebase-ai-app-df21b",
      storageBucket: "sample-firebase-ai-app-df21b.firebasestorage.app",
      messagingSenderId: "762970139210",
      appId: "1:762970139210:web:149e9ab5e9593a484cd4b3"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authButton = document.getElementById('authButton');
    const authPopup = document.getElementById('authPopup');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const voiceBtn = document.getElementById('voiceBtn');
    const resultsDiv = document.getElementById('results');

    let isPopupOpen = false;
    let isLoginMode = true;

    // Auth button toggle popup
    authButton.addEventListener('click', e => {
      e.stopPropagation();
      if (isPopupOpen) closeAuthPopup();
      else openAuthPopup();
    });
    document.addEventListener('click', () => {
      if (isPopupOpen) closeAuthPopup();
    });
    authPopup.addEventListener('click', e => e.stopPropagation());

    function openAuthPopup() {
      isPopupOpen = true;
      authPopup.classList.add('active');
      renderAuthForm();
      authPopup.focus();
    }
    function closeAuthPopup() {
      isPopupOpen = false;
      authPopup.classList.remove('active');
    }

    function updateAuthButton(user) {
      if (user) {
        if (user.photoURL) {
          authButton.innerHTML = `<img src="${user.photoURL}" alt="User photo" />`;
        } else if (user.displayName) {
          authButton.textContent = user.displayName[0].toUpperCase();
        } else if (user.email) {
          authButton.textContent = user.email[0].toUpperCase();
        } else {
          authButton.textContent = "U";
        }
        authButton.title = "é»æ“ŠæŸ¥çœ‹å¸³è™Ÿé¸é …";
      } else {
        authButton.textContent = "ç™»å…¥";
        authButton.title = "é»æ“Šç™»å…¥æˆ–è¨»å†Š";
      }
    }

    function renderAuthForm() {
      if (auth.currentUser) {
        authPopup.innerHTML = `
          <div><strong id="authTitle">ä½¿ç”¨è€…è³‡è¨Š</strong></div>
          <div style="margin: 16px 0; font-weight: 600; font-size: 1.1rem; text-align:center;">
            æ­¡è¿ï¼Œ${auth.currentUser.displayName || auth.currentUser.email}
          </div>
          <button id="logoutBtn">ç™»å‡º</button>
        `;
        document.getElementById('logoutBtn').addEventListener('click', logout);
      } else if (isLoginMode) {
        authPopup.innerHTML = `
          <div><strong id="authTitle">ç™»å…¥ NovaSeek</strong></div>
          <input type="email" id="email" placeholder="Email" autocomplete="username" />
          <input type="password" id="password" placeholder="å¯†ç¢¼" autocomplete="current-password" />
          <button id="loginBtn">ç™»å…¥</button>
          <div class="switch-mode" id="switchToRegister">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š</div>
          <div class="switch-mode" id="forgotPassword">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</div>
          <small>ä½¿ç”¨ Firebase Email/Password ç™»å…¥</small>
        `;
        document.getElementById('loginBtn').addEventListener('click', login);
        document.getElementById('switchToRegister').addEventListener('click', () => switchMode(false));
        document.getElementById('forgotPassword').addEventListener('click', showForgotPasswordForm);
      } else {
        authPopup.innerHTML = `
          <div><strong id="authTitle">è¨»å†Š NovaSeek</strong></div>
          <input type="text" id="name" placeholder="å§“å" autocomplete="name" />
          <input type="email" id="email" placeholder="Email" autocomplete="email" />
          <input type="password" id="password" placeholder="å¯†ç¢¼ (è‡³å°‘6å­—å…ƒ)" autocomplete="new-password" />
          <button id="registerBtn">è¨»å†Š</button>
          <div class="switch-mode" id="switchToLogin">å·²æœ‰å¸³è™Ÿï¼Ÿç™»å…¥</div>
          <small>ä½¿ç”¨ Firebase Email/Password è¨»å†Š</small>
        `;
        document.getElementById('registerBtn').addEventListener('click', register);
        document.getElementById('switchToLogin').addEventListener('click', () => switchMode(true));
      }
    }

    // å¿˜è¨˜å¯†ç¢¼è¡¨å–®
    function showForgotPasswordForm() {
      authPopup.innerHTML = `
        <div><strong id="authTitle">å¿˜è¨˜å¯†ç¢¼</strong></div>
        <input type="email" id="resetEmail" placeholder="è«‹è¼¸å…¥è¨»å†Šçš„ Email" autocomplete="email" />
        <button id="resetBtn">å¯„é€é‡è¨­å¯†ç¢¼ä¿¡</button>
        <div class="switch-mode" id="backToLogin">å›åˆ°ç™»å…¥</div>
        <small>è«‹ç¢ºèªè¼¸å…¥æ­£ç¢ºçš„ Emailï¼Œç³»çµ±å°‡å¯„é€å¯†ç¢¼é‡è¨­ä¿¡ä»¶ã€‚</small>
      `;
      document.getElementById('resetBtn').addEventListener('click', resetPassword);
      document.getElementById('backToLogin').addEventListener('click', () => switchMode(true));
    }

    // Switch login/register
    function switchMode(toLogin) {
      isLoginMode = toLogin;
      renderAuthForm();
    }

    // Register function
    async function register() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!name || !email || password.length < 6) {
        alert('è«‹å®Œæ•´å¡«å¯«å§“åã€Emailï¼Œä¸”å¯†ç¢¼è‡³å°‘6å­—å…ƒ');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        await updateProfile(userCredential.user, { displayName: name });
        alert('è¨»å†ŠæˆåŠŸï¼Œå·²ç™»å…¥');
        closeAuthPopup();
      } catch (error) {
        alert('è¨»å†ŠéŒ¯èª¤: ' + error.message);
      }
    }

    // Login function
    async function login() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!email || !password) {
        alert('è«‹è¼¸å…¥ Email å’Œå¯†ç¢¼');
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert('ç™»å…¥æˆåŠŸ');
        closeAuthPopup();
      } catch (error) {
        alert('ç™»å…¥éŒ¯èª¤: ' + error.message);
      }
    }

    // Logout function
    async function logout() {
      await signOut(auth);
      alert('å·²ç™»å‡º');
      closeAuthPopup();
    }

    // Reset password
    async function resetPassword() {
      const email = document.getElementById('resetEmail').value.trim();
      if (!email) {
        alert('è«‹è¼¸å…¥ Email');
        return;
      }
      try {
        await sendPasswordResetEmail(auth, email);
        alert('é‡è¨­å¯†ç¢¼ä¿¡å·²å¯„å‡º');
        switchMode(true);
      } catch (error) {
        alert('éŒ¯èª¤: ' + error.message);
      }
    }

    // ç›£è½ç™»å…¥ç‹€æ…‹è®ŠåŒ–
    onAuthStateChanged(auth, user => {
      updateAuthButton(user);
    });

    // æœå°‹åŠŸèƒ½ (ç¤ºç¯„ï¼šè®€ Firestore items é›†åˆä¸¦æ ¹æ“šé—œéµå­—éæ¿¾)
    async function performSearch(keyword) {
      resultsDiv.innerHTML = `<p>æœå°‹ä¸­...</p>`;
      if (!keyword.trim()) {
        resultsDiv.innerHTML = `<p>è«‹è¼¸å…¥é—œéµå­—</p>`;
        return;
      }
      try {
        const itemsCol = collection(db, "items");
        const snapshot = await getDocs(itemsCol);
        const results = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.title?.toLowerCase().includes(keyword.toLowerCase())) {
            results.push(data);
          }
        });
        if (results.length === 0) {
          resultsDiv.innerHTML = `<p>æ‰¾ä¸åˆ°ç›¸é—œé …ç›®</p>`;
          return;
        }
        resultsDiv.innerHTML = results.map(item => `
          <div class="item">
            <img src="${item.imageUrl || ''}" alt="${item.title || ''}" />
            <div class="item-content">
              <h3>${item.title || ''}</h3>
              <p>${item.description || ''}</p>
              <small>${item.date || ''}</small>
            </div>
          </div>
        `).join('');
      } catch (error) {
        resultsDiv.innerHTML = `<p>æœå°‹éŒ¯èª¤: ${error.message}</p>`;
      }
    }

    // æŒ‰éˆ•ç¶å®š
    searchBtn.addEventListener('click', () => performSearch(searchInput.value));
    searchInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') performSearch(searchInput.value);
    });

    // èªéŸ³æœå°‹ç¤ºç¯„ï¼ˆWeb Speech APIï¼‰
    voiceBtn.addEventListener('click', () => {
      if (!('webkitSpeechRecognition' in window)) {
        alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'zh-TW';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript;
        searchInput.value = spoken;
        performSearch(spoken);
      };
      recognition.onerror = function(event) {
        alert('èªéŸ³è¾¨è­˜éŒ¯èª¤: ' + event.error);
      };
      recognition.start();
    });

    // èƒŒæ™¯åˆ‡æ›
    const backgrounds = [

      'url(https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1280&q=80)',
      'url(https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=1280&q=80)',
      'url(https://file.51pptmoban.com/d/file/2022/10/07/b8e730e2dbe9a231761b6e956be6bce6.jpg)',
      'url(https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1280&q=80)',
      'url(https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=1280&q=80)'
    ];
    let bgIndex = 0;
    document.querySelector('.background-toggle').addEventListener('click', () => {
      bgIndex = (bgIndex + 1) % backgrounds.length;
      document.body.style.backgroundImage = backgrounds[bgIndex];
    });
    // é è¨­èƒŒæ™¯
    document.body.style.backgroundImage = backgrounds[bgIndex];
  </script>
</body>
</html>
